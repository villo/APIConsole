<!DOCTYPE html>
<html>
    <head>
        <title>Villo API Console - BLEEDING EDGE</title>
        
        <!-- Include jQuery and jqConsole -->
		<script src="jquery.js" type="text/javascript"></script>
		<script src="jqconsole.js" type="text/javascript"></script>
		<!-- Include the bleeding-edge version of Villo -->
		<script src="https://raw.github.com/villo/villojs/master/villo.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="jqconsole.css">
	</head>
	<body>
		<div id="console"></div>
		<script>
			/*
			 * API console management: 
			 */
			villo.extend({
				console: {
					jqconsole: null,
					edit: false,
					actions: {
						/*
						 * Help Function:
						 */
						"help": {
							run: function(){
								return true;
							}
						},
						/*
						 * Clear Screen:
						 */
						"cls": {
							run: function(){
								villo.console.jqconsole.Reset();
								villo.console.startPrompt();
							}
						},
						"clear": "cls",
						"clearscreen": "cls",
						/*
						 * Documentation:
						 */
						"doc": {
							run: function(){
								return true;
							}
						},
						"docs": "doc",
						"documentation": "doc"
					},
					run: function(functionName){
						//TODO: splice out first word
						if(this.actions[functionName]){
							var action = this.actions[functionName];
							if(typeof(action) === "string"){
								//Redirect to another function
								action = this.actions[this.actions[functionName]];
							}
							if(action && action.run && typeof(action.run) === "function"){
								action.run();
							}else{
								this.write("Undefined error occured.");
							}
						}else{
							//run as javascript
							try{
								this.write(this.inspect(eval.call(null, functionName)));
							}catch(e){
								this.write(e);
							};
						}
					},
					write: function(wstring){
						//If type is an object, cycle through level one, and display all of the properties and the type.
						this.jqconsole.Write(wstring + "\n", 'jqconsole-output');
					},
					inspect: function(ins){
						//Do some parsing:
						if(typeof(ins) === "object"){
							return JSON.stringify(ins);
						}else{
							return ins;
						}
						//This method prevents a lot of circular stringify problems, but is very limited:
						/*
						if(typeof(ins) === "object"){
							var returnString = "";
							//jQuery foreach:
							$.each(ins, function(key, value) {
								returnString += ('"' + key + '" (' + typeof(value) + ') \n');
							});
							return returnString;
						}else{
							return ins;
						}
						*/
					}
				}
			});
		</script>
		<script>
		  $(function () {
		    villo.console.jqconsole = $('#console').jqconsole("Welcome to the new API console! \n", ">>> ");
		    //Ctrl+E: Move into edit mode - native multi-line support.
			villo.console.jqconsole.RegisterShortcut('E', function() {
				//Turn it on or off:
				villo.console.edit = !villo.console.edit;
				if(villo.console.edit === true){
					this.Write('Multi-line edit mode enabled.\n', 'jqconsole-output');
				}else{
					this.Write('Multi-line edit mode disabled.\n', 'jqconsole-output');
				}
			});
            //Replace console.log with our function:
            window.console = {
            	log: function () {
					var strings = [];
					
					for (var i = 0; i < arguments.length; i++) {
						if (typeof(arguments[i] == "object")) {
							strings.push(JSON.stringify(arguments[i]));
						} else {
							strings.push(arguments[i]);
						}
					}
            		villo.console.jqconsole.Write(strings.join(" ") + "\n", "jqconsole-output");
            	}
		    };
		    //Set up the prompt:
		    villo.console.startPrompt = function () {
				// Start the prompt with history enabled.
				villo.console.jqconsole.Prompt(true, function (input) {
					// Input was had!
					villo.console.run(input);
					// Output input with the class jqconsole-output.
					//jqconsole.Write(input + '\n', 'jqconsole-output');
					// Restart the prompt.
					villo.console.startPrompt();
				}, function(){
					if(villo.console.edit === true){
						return 0;
					}else{
						return false;
					}
				});
		    };
		    villo.console.startPrompt();
		    
		  });
		  //Universal callback function for dumping data into the
            function callback(transport){
                villo.console.write(transport);
            }
		</script>
	</body>
</html>